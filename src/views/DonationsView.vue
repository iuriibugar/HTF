<template>
  <div class="relative min-h-screen bg-cover bg-center bg-fixed overflow-y-auto" :style="{ backgroundImage: `url(${backgroundImage})` }">
    <!-- –ó–∞—Ç–µ–º–Ω–µ–Ω–Ω—è —Ñ–æ–Ω—É -->
    <div class="absolute inset-0 bg-black opacity-50"></div>

    <!-- –í–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="relative z-10">
      <!-- –•–µ–¥–µ—Ä -->
      <HeaderWrapper />

      <!-- –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
      <div class="flex-1 p-2 sm:p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
          <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
          <div class="mb-5">
            <h1 class="text-sm sm:text-base font-bold text-yellow-400 text-center mb-1 flex items-center justify-center gap-1">
              <span class="text-sm">üíôüíõ</span>
              –ü—ñ–¥—Ç—Ä–∏–º–∞–π –∑–∞—Ö–∏—Å–Ω–∏–∫—ñ–≤ –£–∫—Ä–∞—ó–Ω–∏!
            </h1>
          </div>

          <!-- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
          <div v-if="loading" class="bg-gray-800/50 backdrop-blur-md rounded-2xl shadow-lg p-8 md:p-12 text-center border-2 border-yellow-400">
            <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-yellow-400 mx-auto mb-4"></div>
            <p class="text-white text-lg">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
          </div>

          <!-- –ù–µ–º–∞—î –¥–æ–Ω–∞—Ç—ñ–≤ -->
          <div v-else-if="donations.length === 0" class="bg-gray-800/50 backdrop-blur-md rounded-2xl shadow-lg p-8 md:p-12 text-center border-2 border-yellow-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto mb-4 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <p class="text-white text-xl">–ù–∞ –¥–∞–Ω–∏–π –º–æ–º–µ–Ω—Ç –Ω–µ–º–∞—î –∞–∫—Ç–∏–≤–Ω–∏—Ö –∑–±–æ—Ä—ñ–≤</p>
          </div>

          <!-- –°–ø–∏—Å–æ–∫ –¥–æ–Ω–∞—Ç—ñ–≤ -->
          <div v-else :class="gridClasses">
            <div 
              v-for="donation in donations" 
              :key="donation.id"
              class="bg-gray-800/50 backdrop-blur-md rounded-2xl shadow-lg overflow-hidden transform transition-all duration-300 hover:shadow-xl border-2 border-yellow-400">
              
              <!-- –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è -->
              <div v-if="donation.imageBase64" class="w-full h-64 overflow-hidden bg-gray-700">
                <img 
                  :src="donation.imageBase64" 
                  :alt="donation.title"
                  class="w-full h-full object-cover" />
              </div>
              <div v-else class="w-full h-64 bg-gradient-to-br from-gray-700 to-gray-800 flex items-center justify-center border-b-2 border-yellow-400">
                <span class="text-white text-6xl">üíôüíõ</span>
              </div>
              
              <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
              <div class="p-6">
                <h2 class="text-2xl font-bold text-yellow-400 mb-3">{{ donation.title }}</h2>
                <p class="text-white mb-6 leading-relaxed">{{ donation.description }}</p>
                
                <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–Ω–∞—Ç—É -->
                <a 
                  :href="donation.link" 
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block w-full bg-yellow-400 hover:bg-yellow-500 text-black font-bold py-4 px-6 rounded-xl transition-all duration-300 text-center shadow-lg hover:shadow-xl border-2 border-yellow-400">
                  <span class="flex items-center justify-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    –ü—ñ–¥—Ç—Ä–∏–º–∞—Ç–∏ –∑–±—ñ—Ä
                  </span>
                </a>
                
                <!-- –î–∞—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è -->
                <p class="text-xs text-gray-400 text-center mt-4">
                  –û–Ω–æ–≤–ª–µ–Ω–æ: {{ formatDate(donation.updatedAt) }}
                </p>
              </div>
            </div>
          </div>

          <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∏–π –±–ª–æ–∫ -->
          <div class="mt-5 text-center">
            <h3 class="text-sm font-bold mb-1 text-center text-yellow-400">üá∫üá¶ –†–∞–∑–æ–º –¥–æ –ø–µ—Ä–µ–º–æ–≥–∏!</h3>
            <p class="text-center text-xs mb-1 text-white">
              
            </p>
          </div>

          <!-- –§—É—Ç–µ—Ä -->
          <div class="mt-2">
            <Footer />
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { db } from '@/firebase'
import { collection, getDocs } from 'firebase/firestore'
import HeaderWrapper from '@/components/HeaderWrapper.vue'
import Footer from '@/components/htfFooter.vue'
import backgroundImage from '@/assets/background.png'

const loading = ref(false)
const donations = ref([])

// –î–∏–Ω–∞–º—ñ—á–Ω—ñ –∫–ª–∞—Å–∏ —Å—ñ—Ç–∫–∏ –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –¥–æ–Ω–∞—Ç—ñ–≤
const gridClasses = computed(() => {
  const count = donations.value.length
  
  if (count === 1) {
    // 1 –¥–æ–Ω–∞—Ç - –ø–æ —Ü–µ–Ω—Ç—Ä—É, –æ–¥–Ω–∞ –∫–æ–ª–æ–Ω–∫–∞
    return 'grid grid-cols-1 md:grid-cols-1 gap-6 max-w-md mx-auto'
  } else if (count === 2) {
    // 2 –¥–æ–Ω–∞—Ç–∏ - –ø–æ —Ü–µ–Ω—Ç—Ä—É, –¥–≤—ñ –∫–æ–ª–æ–Ω–∫–∏
    return 'grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto'
  } else if (count === 3) {
    // 3 –¥–æ–Ω–∞—Ç–∏ - –ø–æ —Ü–µ–Ω—Ç—Ä—É, —Ç—Ä–∏ –∫–æ–ª–æ–Ω–∫–∏
    return 'grid grid-cols-1 md:grid-cols-3 gap-6'
  } else {
    // 4+ –¥–æ–Ω–∞—Ç—ñ–≤ - –¥–≤—ñ –∫–æ–ª–æ–Ω–∫–∏
    return 'grid grid-cols-1 md:grid-cols-2 gap-6'
  }
})

// –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å—ñ –¥–æ–Ω–∞—Ç–∏
async function loadDonations() {
  try {
    loading.value = true
    const querySnapshot = await getDocs(collection(db, 'donations'))
    
    donations.value = []
    querySnapshot.forEach(doc => {
      donations.value.push({ id: doc.id, ...doc.data() })
    })
    
    // –°–æ—Ä—Ç—É—î–º–æ –∑–∞ –¥–∞—Ç–æ—é –æ–Ω–æ–≤–ª–µ–Ω–Ω—è (–Ω–æ–≤—ñ—à—ñ —Å–ø–æ—á–∞—Ç–∫—É)
    donations.value.sort((a, b) => {
      return new Date(b.updatedAt || 0) - new Date(a.updatedAt || 0)
    })
  } catch (error) {
    console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–Ω–∞—Ç—ñ–≤:', error)
  } finally {
    loading.value = false
  }
}

// –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –¥–∞—Ç–∏
function formatDate(dateStr) {
  if (!dateStr) return '–ù–µ–≤—ñ–¥–æ–º–æ'
  const date = new Date(dateStr)
  return date.toLocaleString('uk-UA', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}

onMounted(() => {
  loadDonations()
})
</script>
