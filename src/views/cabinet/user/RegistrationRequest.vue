<template>
  <div class="max-w-2xl mx-auto">
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
    <div class="bg-yellow-600/20 border-2 border-yellow-400 rounded-lg p-6 mb-6">
      <h2 class="text-2xl font-bold text-yellow-300 mb-2">üëã –í—ñ—Ç–∞—î–º–æ —É —Å–ø—ñ–ª—å–Ω–æ—Ç—ñ!</h2>
      <p class="text-yellow-100">
        –î–ª—è –ø–æ–≤–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–æ–≤–Ω–∏—Ç–∏ —Ñ–æ—Ä–º—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —ñ —á–µ–∫–∞—Ç–∏ –æ–¥–æ–±—Ä–µ–Ω–Ω—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
        –¶–µ –∑–∞–π–º–µ –Ω–µ –±—ñ–ª—å—à–µ 24 –≥–æ–¥–∏–Ω.
      </p>
    </div>

    <!-- –§–æ—Ä–º–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
    <div class="bg-gray-800/50 backdrop-blur-md rounded-lg p-6 border border-gray-600">
      <form @submit.prevent="submitRegistration" class="space-y-4">
        <!-- –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ -->
        <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
          <h3 class="text-lg font-semibold text-yellow-400 mb-4">üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ</h3>
          
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <!-- –Ü–º'—è -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–Ü–º'—è *</label>
              <input
                v-model="formData.firstName"
                type="text"
                placeholder="–í–∞—à–µ —ñ–º'—è"
                required
                class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-500 focus:outline-none focus:border-yellow-400"
              />
            </div>

            <!-- –ü—Ä—ñ–∑–≤–∏—â–µ -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–ü—Ä—ñ–∑–≤–∏—â–µ *</label>
              <input
                v-model="formData.lastName"
                type="text"
                placeholder="–í–∞—à–µ –ø—Ä—ñ–∑–≤–∏—â–µ"
                required
                class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-500 focus:outline-none focus:border-yellow-400"
              />
            </div>

            <!-- –¢–µ–ª–µ—Ñ–æ–Ω -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
              <input
                v-model="formData.phone"
                type="tel"
                placeholder="+38 (0XX) XXX-XX-XX"
                required
                class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-500 focus:outline-none focus:border-yellow-400"
              />
            </div>

            <!-- –ú—ñ—Å—Ç–æ -->
            <div>
              <label class="block text-sm font-medium text-gray-300 mb-2">–ú—ñ—Å—Ç–æ *</label>
              <input
                v-model="formData.city"
                type="text"
                placeholder="–í–∞—à–µ –º—ñ—Å—Ç–æ"
                required
                class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-500 focus:outline-none focus:border-yellow-400"
              />
            </div>
          </div>
        </div>

        <!-- –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å–ø–æ—Ä—Ç -->
        <div class="bg-gray-700/30 rounded-lg p-4 border border-gray-600">
          <h3 class="text-lg font-semibold text-yellow-400 mb-4">üèÉ –°–ø–æ—Ä—Ç–∏–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h3>
          
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">–†—ñ–≤–µ–Ω—å –¥–æ—Å–≤—ñ–¥—É *</label>
            <select
              v-model="formData.experienceLevel"
              required
              class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white focus:outline-none focus:border-yellow-400"
            >
              <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å —Ä—ñ–≤–µ–Ω—å --</option>
              <option value="beginner">–ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å</option>
              <option value="intermediate">–õ—é–±–∏—Ç–µ–ª—å</option>
              <option value="advanced">–î–æ—Å–≤—ñ–¥—á–µ–Ω–∏–π</option>
              <option value="professional">–ü—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª</option>
            </select>
          </div>
        </div>

        <!-- –î–æ–¥–∞—Ç–∫–æ–≤—ñ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
        <div>
          <label class="block text-sm font-medium text-gray-300 mb-2">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label>
          <textarea
            v-model="formData.bio"
            placeholder="–†–æ–∑–∫–∞–∂—ñ—Ç—å –ø—Ä–æ —Å–µ–±–µ, –≤–∞—à—ñ —Ü—ñ–ª—ñ —Ç–∞ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è..."
            rows="4"
            class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded text-white placeholder-gray-500 focus:outline-none focus:border-yellow-400"
          ></textarea>
        </div>

        <!-- –ü–æ–º–∏–ª–∫–∞ -->
        <div v-if="error" class="bg-red-600/20 border border-red-400 rounded-lg p-4 text-red-300">
          {{ error }}
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="flex gap-4 pt-4">
          <button
            type="submit"
            :disabled="isSubmitting"
            class="flex-1 bg-yellow-400 hover:bg-yellow-500 disabled:bg-gray-600 text-black font-bold px-6 py-3 rounded-lg transition"
          >
            {{ isSubmitting ? '‚è≥ –í—ñ–¥–ø—Ä–∞–≤–ª—è—é...' : 'üì§ –ù–∞–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç' }}
          </button>
        </div>
      </form>
    </div>

    <!-- –°—Ç–∞—Ç—É—Å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è -->
    <div v-if="submitted" class="mt-6 bg-green-600/20 border-2 border-green-400 rounded-lg p-6 text-center">
      <h3 class="text-xl font-bold text-green-300 mb-2">‚úÖ –ó–∞–ø–∏—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ!</h3>
      <p class="text-green-100">
        –î—è–∫—É—î–º–æ –∑–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é! –í–∞—à –∑–∞–ø–∏—Ç –ø–µ—Ä–µ–≥–ª—è–Ω—É–≤ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—Ä–æ—Ç—è–≥–æ–º 24 –≥–æ–¥–∏–Ω.
        –í–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è, –∫–æ–ª–∏ –≤–∞—à –∞–∫–∞—É–Ω—Ç –±—É–¥–µ –æ–¥–æ–±—Ä–µ–Ω–æ.
      </p>
    </div>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { auth } from '@/firebase'
import { updateUserProfile } from '@/services/userService'
import { showLoader, hideLoader } from '@/stores/loaderStore'

const formData = ref({
  firstName: '',
  lastName: '',
  phone: '',
  city: '',
  experienceLevel: '',
  bio: ''
})

const isSubmitting = ref(false)
const error = ref('')
const submitted = ref(false)

async function submitRegistration() {
  try {
    error.value = ''
    isSubmitting.value = true
    showLoader()

    const user = auth.currentUser
    if (!user) {
      throw new Error('–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π')
    }

    // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ñ –¥–∞–Ω—ñ
    const result = await updateUserProfile(user.uid, {
      firstName: formData.value.firstName,
      lastName: formData.value.lastName,
      phone: formData.value.phone,
      city: formData.value.city,
      experienceLevel: formData.value.experienceLevel,
      bio: formData.value.bio
    })

    if (result) {
      submitted.value = true
      // –û—á–∏—â—É—î–º–æ —Ñ–æ—Ä–º—É
      setTimeout(() => {
        formData.value = {
          firstName: '',
          lastName: '',
          phone: '',
          city: '',
          experienceLevel: '',
          bio: ''
        }
      }, 3000)
    } else {
      error.value = '–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ –¥–∞–Ω–∏—Ö. –°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ.'
    }
  } catch (err) {
    error.value = '–ü–æ–º–∏–ª–∫–∞: ' + err.message
    console.error('–ü–æ–º–∏–ª–∫–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó:', err)
  } finally {
    isSubmitting.value = false
    hideLoader()
  }
}
</script>
